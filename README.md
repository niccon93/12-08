# Домашнее задание к занятию «Резервное копирование баз данных»

**Домашнее задание выполните в Google Docs или в md-файле в вашем репозитории GitHub.** 

Для оформления вашего решения в GitHub можете воспользоваться [шаблоном](https://github.com/netology-code/sys-pattern-homework).

Название файла должно содержать номер лекции и фамилию студента. Пример названия: «12.8. Резервное копирование баз данных — Александр Александров».

Перед тем как выслать ссылку, убедитесь, что её содержимое не является приватным, то есть открыто на просмотр всем, у кого есть ссылка. Если необходимо прикрепить дополнительные ссылки, просто добавьте их в свой Google Docs.

Любые вопросы по решению задач задавайте в чате учебной группы.

---

### Задание 1. Резервное копирование

### Кейс
Финансовая компания решила увеличить надёжность работы баз данных и их резервного копирования. 

Необходимо описать, какие варианты резервного копирования подходят в случаях: 

1.1. Необходимо восстанавливать данные в полном объёме за предыдущий день.

1.2. Необходимо восстанавливать данные за час до предполагаемой поломки.

1.3.* Возможен ли кейс, когда при поломке базы происходило моментальное переключение на работающую или починенную базу данных.

*Приведите ответ в свободной форме.*

### Ответ

1.1. Восстановление данных в полном объеме за предыдущий день
В этом случае подойдет стратегия полного резервного копирования. Это подразумевает создание полных копий данных на регулярной основе (например, ежедневно). Однако это может быть ресурсоемким, так как каждый день будет создаваться полный набор данных.

- **Полное резервное копирование**: Это метод, при котором каждый файл на сервере копируется в полном объеме. Преимущества включают возможность восстановления любого конкретного файла или всей системы на любой момент времени, а недостатками является высокое использование пространства для хранения и времени на копирование.

1.2. Восстановление данных за час до предполагаемой поломки
В этом случае подойдет стратегия инкрементного или дифференциального резервного копирования. Они включают создание копий только тех файлов, которые изменились с момента последнего резервного копирования. Это может быть более эффективным, но восстановление может потребовать более сложного процесса.

- **Инкрементное резервное копирование**: Это метод, при котором копируются только файлы, изменившиеся с момента последнего резервного копирования (будь то полное или предыдущее инкрементное резервное копирование). Преимущества включают уменьшение объема данных для копирования и ускорение самого процесса резервного копирования, но при восстановлении может потребоваться учет порядка восстановления инкрементных копий.

- **Дифференциальное резервное копирование**: Этот метод копирует все файлы, измененные с момента последнего ПОЛНОГО резервного копирования. Дифференциальное резервное копирование требует больше места для хранения, чем инкрементное, но процесс восстановления обычно более прост, поскольку не требуется учет порядка восстановления различных копий.

1.3. Моментальное переключение на работающую или починенную базу данных
Это возможно, но при этом требуются тщательно продуманные и разработанные системы. Такие сценарии обычно включают в себя зеркальное отображение или репликацию данных.

- **Зеркальное отображение**: Это процесс создания точной копии базы данных в реальном времени. Это позволяет моментально переключиться на зеркально отображенную базу данных в случае сбоя основного хранилища. Имея в распоряжении зеркало, можно с минимальной задержкой восстановить работу системы.

- **Репликация**: Это процесс копирования данных из одной базы данных в другую для обеспечения согласованности. Это может быть полезно для управления направлениями трафика и распределения нагрузки.

Каждая из этих стратегий имеет свои собственные требования к ресурсам, а также важно регулярно тестировать процессы восстановления, чтобы убедиться, что они работают как ожидается.

---

### Задание 2. PostgreSQL

2.1. С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).

2.1.* Возможно ли автоматизировать этот процесс? Если да, то как?

*Приведите ответ в свободной форме.*

### Ответ

2.1.
Пример команды резервирования данных с использованием pg_dump:

```
pg_dump -U username -d dbname -f backup.sql
```

где:
-U username - имя пользователя базы данных
-d dbname - имя базы данных
-f backup.sql - имя файла, в который будет сохранен резервный дамп

Пример команды восстановления БД с использованием pg_restore:

```
pg_restore -U username -d dbname backup.sql
```

где:
-U username - имя пользователя базы данных
-d dbname - имя базы данных
backup.sql - имя файла резервного дампа

2.1.* Да, этот процесс можно автоматизировать. Например, можно создать скрипт, который будет выполнять команды резервирования и восстановления данных в заданное время или по расписанию. Этот скрипт можно запускать с помощью планировщика задач операционной системы, такого как cron в Linux или Task Scheduler в Windows. Также можно использовать специализированные инструменты для автоматизации резервирования и восстановления данных, такие как pgBackRest или Barman.

---

### Задание 3. MySQL

3.1. С помощью официальной документации приведите пример команды инкрементного резервного копирования базы данных MySQL. 

3.1.* В каких случаях использование реплики будет давать преимущество по сравнению с обычным резервным копированием?

*Приведите ответ в свободной форме.*

### Ответ

3.1.
Пример команды инкрементного резервного копирования базы данных MySQL:

```
mysqldump --user=username --password=password --single-transaction --master-data=2 --databases database_name > backup.sql
```

В данном примере:

--user=username - указывает имя пользователя MySQL для подключения к базе данных.

--password=password - указывает пароль пользователя MySQL.

--single-transaction - выполняет копирование базы данных в одной транзакции, чтобы избежать блокировки таблиц.

--master-data=2 - добавляет информацию о бинарных журналах и позиции бинарного журнала в резервную копию.

--databases database_name - указывает имя базы данных, которую нужно скопировать.

> backup.sql - перенаправляет вывод команды в файл backup.sql.

3.1.* Использование реплики может быть выгодным в следующих случаях:
- Если требуется непрерывная доступность базы данных, так как реплика может использоваться для чтения данных, пока основная база данных находится в процессе резервного копирования;
- Если требуется быстрое восстановление базы данных, так как реплика уже содержит актуальные данные и не требует полного восстановления из резервной копии;
- Если требуется распределение нагрузки на чтение данных, так как реплика может использоваться для обработки запросов на чтение, разгружая основную базу данных;
- Если требуется защита от сбоев и потери данных, так как реплика может служить в качестве резервной копии, готовой к использованию в случае сбоя основной базы данных.

---

Задания, помеченные звёздочкой, — дополнительные, то есть не обязательные к выполнению, и никак не повлияют на получение вами зачёта по этому домашнему заданию. Вы можете их выполнить, если хотите глубже шире разобраться в материале.
